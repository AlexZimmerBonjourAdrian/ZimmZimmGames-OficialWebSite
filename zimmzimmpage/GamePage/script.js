// --- Translations ---
    const translations = {
      en: { // Default Language
        page_title: "Game Title - Psychological Horror Adventure",
        nav_game: "Game", nav_story: "Interactive Story", nav_demo: "Demo", nav_staff: "The Staff", nav_about: "About Me", nav_faq: "FAQ", nav_rabbit_hole: "Rabbit Hole", nav_contact: "Contact", nav_donations: "Donations",
        lang_select_label: "Language:",
        main_game_title: "Game Title", buy_button: "Buy Now", concept_art_title: "Concept Art",
        story_title: "Interactive Story",
        demo_title: "Demo", demo_intro: "Dare to try a fragment of madness?", demo_download_prompt: "Download the demo here:", demo_link_steam: "Download Demo for PC (Steam)", demo_link_itch: "Download Demo for PC (Itch.io)", demo_link_other: "Other Platform", demo_outro: "Immerse yourself in the twisted world and experience the suspense...",
        staff_title: "Meet the Staff", staff_world_intro: "Enter a world reflected in a broken looking glass, where logic bends and familiar faces hide unsettling truths. The 'Staff' are the permanent residents, each bound by their own distorted reality.",
        staff_char1_name: "The Clockmaker", staff_char1_desc: "Obsessed with time, yet perpetually late. His clocks tick backwards, counting down to an unknown event.",
        staff_char2_name: "The Tea Hostess", staff_char2_desc: "Offers tea that tastes like forgotten memories. Her smile never quite reaches her vacant eyes.",
        staff_char3_name: "The Gardener", staff_char3_desc: "Tends to roses that weep blood and whisper secrets only the lost can hear.",
        staff_char4_name: "The Cheshire Cat(?)", staff_char4_desc: "A flickering grin in the shadows. Offers cryptic advice that leads deeper into confusion.",
        staff_char5_name: "The Card Soldier", staff_char5_desc: "Follows orders without question, painting white roses red with something other than paint.",
        staff_char6_name: "The Queen of Hearts", staff_char6_desc: "Her rage is the law. Her deck is stacked, and losing means losing your head... or worse.",
        about_title: "About the Developer", about_p1: "I am Developer Name / Studio, an independent developer passionate about creating immersive and unsettling experiences.", about_p2: "My goal with Game Title is to explore the darkest corners of the human psyche, wrapped in a surreal aesthetic inspired by classic tales, but with a macabre twist.", about_p3: "This project is a personal journey into psychological horror, combining narrative, atmosphere, and mystery.", about_p4: "You can follow the development and my thoughts on my social media.",
        faq_title: "Frequently Asked Questions (FAQ)", faq_q_platforms: "Q: What platforms will the game be available on?", faq_a_platforms: "A: The initial release is planned for PC (Steam). We are exploring the possibility of bringing it to consoles in the future.", faq_q_release: "Q: What is the estimated release date?", faq_a_release: "A: We are currently working hard. The estimated date is Coming Soon. Follow our networks for updates!", faq_q_langs: "Q: Will the game support specific languages?", faq_a_langs: "A: The game will launch in initial languages. We are considering adding more languages post-launch based on community interest.", faq_q_inspired: "Q: What inspired the game's aesthetic?", faq_a_inspired: "A: The main inspiration is a fusion between the dreamlike and disorienting atmosphere of \"Alice in Wonderland\" and classic elements of suspense and psychological horror cinema, seeking to create a familiar yet deeply unsettling world.", faq_q_jumpscares: "Q: Is it a horror game with jumpscares?", faq_a_jumpscares: "A: The main focus is on psychological horror, atmosphere, and narrative suspense. There may be startling moments, but it doesn't rely primarily on jumpscares to generate fear.",
        rabbit_hole_title: "Peek into the Rabbit Hole",
        contact_title: "Contact", contact_intro: "Do you have questions, comments, or suggestions? Contact us!", contact_label_name: "Name:", contact_label_email: "Email:", contact_label_message: "Message:", contact_button_send: "Send", contact_feedback_success: "Message sent successfully (simulation). Thank you!", contact_feedback_error: "Error sending message (simulation). Please try again.",
        donations_title: "Support Us / Donations", donations_intro: "Independent game development requires a lot of effort and dedication. If you enjoy our work and want to support the creation of Game Title and future projects, consider making a donation. Every contribution helps!", donations_popular_platforms: "Popular Platforms", donations_paypal: "Donate with PayPal", donations_patreon: "Support on Patreon", donations_kofi: "Buy Me a Coffee (Ko-fi)", donations_direct_title: "Direct Donation (Recommended)", donations_direct_intro: "This is the most direct way to support, ensuring that most of your contribution goes towards development without intermediaries.", donations_direct_button: "Make a Direct Donation",
        copyright: "&copy; 2024 Developer Name / Studio. All rights reserved."
      },
      es: {
        page_title: "Título del Juego - Aventura de Terror Psicológico",
        nav_game: "Juego", nav_story: "Historia Interactiva", nav_demo: "Demo", nav_staff: "El Staff", nav_about: "Sobre Mí", nav_faq: "FAQ", nav_rabbit_hole: "Agujero Conejo", nav_contact: "Contacto", nav_donations: "Donaciones",
        lang_select_label: "Idioma:",
        main_game_title: "Título del Juego", buy_button: "Comprar Ahora", concept_art_title: "Arte Conceptual",
        story_title: "Historia Interactiva",
        demo_title: "Demo", demo_intro: "¿Te atreves a probar un fragmento de la locura?", demo_download_prompt: "Descarga la demo aquí:", demo_link_steam: "Descargar Demo para PC (Steam)", demo_link_itch: "Descargar Demo para PC (Itch.io)", demo_link_other: "Otra Plataforma", demo_outro: "Sumérgete en el retorcido mundo y experimenta el suspense...",
        staff_title: "Conoce al Staff", staff_world_intro: "Entra en un mundo reflejado en un espejo roto, donde la lógica se dobla y rostros familiares esconden verdades inquietantes. El 'Staff' son los residentes permanentes, cada uno atado por su propia realidad distorsionada.",
        staff_char1_name: "El Relojero", staff_char1_desc: "Obsesionado con el tiempo, pero perpetuamente tarde. Sus relojes hacen tic-tac hacia atrás, contando hacia un evento desconocido.",
        staff_char2_name: "La Anfitriona del Té", staff_char2_desc: "Ofrece té que sabe a recuerdos olvidados. Su sonrisa nunca llega del todo a sus ojos vacíos.",
        staff_char3_name: "El Jardinero", staff_char3_desc: "Cuida rosas que lloran sangre y susurran secretos que solo los perdidos pueden oír.",
        staff_char4_name: "El Gato de Cheshire(?)", staff_char4_desc: "Una sonrisa parpadeante en las sombras. Ofrece consejos crípticos que llevan más profundo en la confusión.",
        staff_char5_name: "El Soldado de Carta", staff_char5_desc: "Sigue órdenes sin preguntar, pintando rosas blancas de rojo con algo más que pintura.",
        staff_char6_name: "La Reina de Corazones", staff_char6_desc: "Su furia es la ley. Su baraja está trucada, y perder significa perder la cabeza... o algo peor.",
        about_title: "Sobre el Desarrollador", about_p1: "Soy Nombre Desarrollador / Estudio, un desarrollador independiente apasionado por crear experiencias inmersivas y perturbadoras.", about_p2: "Mi objetivo con Título del Juego es explorar los rincones más oscuros de la psique humana, envuelto en una estética surrealista inspirada en los cuentos clásicos, pero con un giro macabro.", about_p3: "Este proyecto es un viaje personal hacia el terror psicológico, combinando narrativa, atmósfera y misterio.", about_p4: "Puedes seguir el desarrollo y mis pensamientos en mis redes sociales.",
        faq_title: "Preguntas Frecuentes (FAQ)", faq_q_platforms: "P: ¿En qué plataformas estará disponible el juego?", faq_a_platforms: "R: El lanzamiento inicial está planeado para PC (Steam). Estamos explorando la posibilidad de llevarlo a consolas en el futuro.", faq_q_release: "P: ¿Cuál es la fecha de lanzamiento estimada?", faq_a_release: "R: Actualmente estamos trabajando arduamente. La fecha estimada es Próximamente. ¡Sigue nuestras redes para actualizaciones!", faq_q_langs: "P: ¿El juego tendrá soporte para idiomas específicos?", faq_a_langs: "R: El juego se lanzará en idiomas iniciales. Estamos considerando añadir más idiomas post-lanzamiento basados en el interés de la comunidad.", faq_q_inspired: "P: ¿Qué inspiró la estética del juego?", faq_a_inspired: "R: La principal inspiración es una fusión entre la atmósfera onírica y desorientadora de \"Alicia en el País de las Maravillas\" y elementos clásicos del cine de suspense y terror psicológico, buscando crear un mundo familiar pero profundamente inquietante.", faq_q_jumpscares: "P: ¿Es un juego de terror con 'jumpscares'?", faq_a_jumpscares: "R: El enfoque principal está en el terror psicológico, la atmósfera y el suspense narrativo. Puede haber momentos sobresaltantes, pero no dependen principalmente de 'jumpscares' para generar miedo.",
        rabbit_hole_title: "Asómate en el Agujero del Conejo",
        contact_title: "Contacto", contact_intro: "¿Tienes preguntas, comentarios o propuestas? ¡Contáctame!", contact_label_name: "Nombre:", contact_label_email: "Email:", contact_label_message: "Mensaje:", contact_button_send: "Enviar Mensaje", contact_feedback_success: "Mensaje enviado con éxito (simulación). ¡Gracias!", contact_feedback_error: "Error al enviar mensaje (simulación). Por favor, inténtalo de nuevo.",
        donations_title: "Apóyanos / Donaciones", donations_intro: "El desarrollo de juegos independientes requiere mucho esfuerzo y dedicación. Si disfrutas de mi trabajo y quieres apoyar la creación de Título del Juego y futuros proyectos, considera hacer una donación. ¡Cada contribución ayuda enormemente!", donations_popular_platforms: "Plataformas Populares", donations_paypal: "Donar con PayPal", donations_patreon: "Apoyar en Patreon", donations_kofi: "Invítame un Café (Ko-fi)", donations_direct_title: "Donación Directa (Recomendado)", donations_direct_intro: "Esta es la forma más directa de apoyar, asegurando que la mayor parte de tu contribución llegue al desarrollo sin intermediarios.", donations_direct_button: "Realizar Donación Directa",
        copyright: "&copy; 2024 Nombre Desarrollador / Estudio. Todos los derechos reservados."
      },
      ja: { // Placeholders
        page_title: "ゲームタイトル - 心理ホラーアドベンチャー",
        nav_game: "ゲーム", nav_story: "インタラクティブストーリー", nav_demo: "デモ", nav_staff: "スタッフ", nav_about: "開発者について", nav_faq: "よくある質問", nav_rabbit_hole: "ウサギの穴", nav_contact: "連絡先", nav_donations: "寄付",
        lang_select_label: "言語:",
        main_game_title: "ゲームタイトル", buy_button: "今すぐ購入", concept_art_title: "コンセプトアート",
        story_title: "インタラクティブストーリー",
        demo_title: "デモ", demo_intro: "狂気のかけらを試してみませんか？", demo_download_prompt: "デモはこちらからダウンロード:", demo_link_steam: "PC用デモをダウンロード (Steam)", demo_link_itch: "PC用デモをダウンロード (Itch.io)", demo_link_other: "他のプラットフォーム", demo_outro: "歪んだ世界に没入し、サスペンスを体験してください...",
        staff_title: "スタッフ紹介", staff_world_intro: "壊れた鏡に映る世界へようこそ。そこでは論理が曲がり、見慣れた顔が不穏な真実を隠しています。「スタッフ」は永住者であり、それぞれが独自の歪んだ現実に縛られています。",
        staff_char1_name: "時計職人", staff_char1_desc: "時間に執着しているが、常に遅刻している。彼の時計は逆さまに刻み、未知のイベントへのカウントダウンをしている。",
        staff_char2_name: "ティーホステス", staff_char2_desc: "忘れられた記憶の味がするお茶を提供する。彼女の笑顔は、空虚な目に決して届かない。",
        staff_char3_name: "庭師", staff_char3_desc: "血を流し、失われた者だけが聞くことができる秘密をささやくバラの世話をする。",
        staff_char4_name: "チェシャ猫(?)", staff_char4_desc: "影の中でちらつく笑顔。混乱を深める不可解なアドバイスを提供する。",
        staff_char5_name: "カード兵士", staff_char5_desc: "疑問を抱かずに命令に従い、白いバラをペンキ以外の何かで赤く塗る。",
        staff_char6_name: "ハートの女王", staff_char6_desc: "彼女の怒りが法律だ。彼女のデッキは積み重ねられており、負けることは頭を失うこと…あるいはそれ以上のことを意味する。",
        about_title: "開発者について", about_p1: "私は開発者名 / スタジオ、没入型で不安な体験を作ることに情熱を燃やす独立系開発者です。", about_p2: "ゲームタイトルでの私の目標は、古典的な物語に触発されたシュールな美学に包まれ、しかし不気味なひねりを加えた、人間の精神の最も暗い隅を探求することです。", about_p3: "このプロジェクトは、物語、雰囲気、謎を組み合わせた、心理的ホラーへの個人的な旅です。", about_p4: "開発状況や私の考えは、私のソーシャルメディアでフォローできます。",
        faq_title: "よくある質問 (FAQ)", faq_q_platforms: "Q: ゲームはどのプラットフォームで利用できますか？", faq_a_platforms: "A: 初期リリースはPC（Steam）で計画されています。将来的にはコンソールへの移植の可能性を探っています。", faq_q_release: "Q: 推定リリース日はいつですか？", faq_a_release: "A: 現在、鋭意開発中です。推定日は近日公開です。最新情報については、私たちのネットワークをフォローしてください！", faq_q_langs: "Q: ゲームは特定の言語をサポートしますか？", faq_a_langs: "A: ゲームは初期言語でリリースされます。コミュニティの関心に基づいて、リリース後に追加の言語を追加することを検討しています。", faq_q_inspired: "Q: ゲームの美学は何に触発されましたか？", faq_a_inspired: "A: 主なインスピレーションは、「不思議の国のアリス」の夢のような方向感覚を失わせる雰囲気と、サスペンスと心理的ホラー映画の古典的な要素の融合であり、馴染み深いが深く不安な世界を作り出すことを目指しています。", faq_q_jumpscares: "Q: ジャンプスケアのあるホラーゲームですか？", faq_a_jumpscares: "A: 主な焦点は心理的ホラー、雰囲気、物語のサスペンスです。驚くような瞬間があるかもしれませんが、恐怖を生み出すために主にジャンプスケアに依存するわけではありません。",
        rabbit_hole_title: "ウサギの穴を覗く",
        contact_title: "連絡先", contact_intro: "質問、コメント、提案がありますか？私に連絡してください！", contact_label_name: "名前:", contact_label_email: "Eメール:", contact_label_message: "メッセージ:", contact_button_send: "メッセージを送信", contact_feedback_success: "メッセージは正常に送信されました（シミュレーション）。ありがとうございます！", contact_feedback_error: "メッセージの送信中にエラーが発生しました（シミュレーション）。もう一度お試しください。",
        donations_title: "サポート/寄付", donations_intro: "独立系ゲーム開発には多くの努力と献身が必要です。私の作品を楽しんで、ゲームタイトルや将来のプロジェクトの作成をサポートしたい場合は、寄付をご検討ください。すべての貢献が非常に役立ちます！", donations_popular_platforms: "人気のプラットフォーム", donations_paypal: "PayPalで寄付", donations_patreon: "Patreonでサポート", donations_kofi: "コーヒーをおごる (Ko-fi)", donations_direct_title: "直接寄付（推奨）", donations_direct_intro: "これはサポートする最も直接的な方法であり、貢献の大部分が仲介者なしで開発に確実に届くようにします。", donations_direct_button: "直接寄付を行う",
        copyright: "&copy; 2024 開発者名 / スタジオ. 全著作権所有。"
      },
      ru: { // Placeholders
        page_title: "Название Игры - Психологическое хоррор-приключение",
        nav_game: "Игра", nav_story: "Интерактивная история", nav_demo: "Демо", nav_staff: "Персонал", nav_about: "Обо мне", nav_faq: "ЧАВО", nav_rabbit_hole: "Кроличья нора", nav_contact: "Контакт", nav_donations: "Пожертвования",
        lang_select_label: "Язык:",
        main_game_title: "Название Игры", buy_button: "Купить сейчас", concept_art_title: "Концепт-арт",
        story_title: "Интерактивная история",
        demo_title: "Демо", demo_intro: "Осмелитесь попробовать фрагмент безумия?", demo_download_prompt: "Скачать демо здесь:", demo_link_steam: "Скачать демо для ПК (Steam)", demo_link_itch: "Скачать демо для ПК (Itch.io)", demo_link_other: "Другая Платформа", demo_outro: "Погрузитесь в искаженный мир и испытайте напряжение...",
        staff_title: "Знакомьтесь с персоналом", staff_world_intro: "Войдите в мир, отраженный в разбитом зеркале, где логика изгибается, а знакомые лица скрывают тревожные истины. «Персонал» - это постоянные жители, каждый из которых связан своей искаженной реальностью.",
        staff_char1_name: "Часовщик", staff_char1_desc: "Одержим временем, но вечно опаздывает. Его часы тикают назад, отсчитывая время до неизвестного события.",
        staff_char2_name: "Хозяйка Чаепития", staff_char2_desc: "Предлагает чай со вкусом забытых воспоминаний. Ее улыбка никогда не достигает пустых глаз.",
        staff_char3_name: "Садовник", staff_char3_desc: "Ухаживает за розами, которые плачут кровью и шепчут секреты, которые могут услышать только потерянные.",
        staff_char4_name: "Чеширский Кот(?)", staff_char4_desc: "Мерцающая ухмылка в тени. Дает загадочные советы, которые ведут глубже в замешательство.",
        staff_char5_name: "Карточный Солдат", staff_char5_desc: "Беспрекословно выполняет приказы, окрашивая белые розы в красный цвет чем-то иным, кроме краски.",
        staff_char6_name: "Червонная Королева", staff_char6_desc: "Ее гнев - закон. Ее колода подтасована, и проигрыш означает потерю головы... или хуже.",
        about_title: "О разработчике", about_p1: "Я Имя Разработчика / Студия, независимый разработчик, увлеченный созданием захватывающих и тревожных впечатлений.", about_p2: "Моя цель в Название Игры - исследовать самые темные уголки человеческой психики, обернутые в сюрреалистическую эстетику, вдохновленную классическими сказками, но с жутким поворотом.", about_p3: "Этот проект - личное путешествие в психологический ужас, сочетающее повествование, атмосферу и тайну.", about_p4: "Вы можете следить за разработкой и моими мыслями в моих социальных сетях.",
        faq_title: "Часто задаваемые вопросы (ЧАВО)", faq_q_platforms: "В: На каких платформах будет доступна игра?", faq_a_platforms: "О: Первоначальный выпуск запланирован для ПК (Steam). Мы изучаем возможность переноса на консоли в будущем.", faq_q_release: "В: Какова предполагаемая дата выпуска?", faq_a_release: "О: В настоящее время мы усердно работаем. Предполагаемая дата - Скоро. Следите за нашими сетями для обновлений!", faq_q_langs: "В: Будет ли игра поддерживать определенные языки?", faq_a_langs: "О: Игра будет выпущена на начальных языках. Мы рассматриваем возможность добавления дополнительных языков после запуска на основе интереса сообщества.", faq_q_inspired: "В: Что вдохновило эстетику игры?", faq_a_inspired: "О: Основное вдохновение - это слияние сказочной и дезориентирующей атмосферы \"Алисы в стране чудес\" и классических элементов саспенса и психологического хоррора, стремящееся создать знакомый, но глубоко тревожный мир.", faq_q_jumpscares: "В: Это хоррор-игра со скримерами?", faq_a_jumpscares: "О: Основное внимание уделяется психологическому ужасу, атмосфере и повествовательному напряжению. Могут быть пугающие моменты, но игра не полагается в первую очередь на скримеры для создания страха.",
        rabbit_hole_title: "Загляните в Кроличью Нору",
        contact_title: "Контакт", contact_intro: "Есть вопросы, комментарии или предложения? Свяжитесь со мной!", contact_label_name: "Имя:", contact_label_email: "Email:", contact_label_message: "Сообщение:", contact_button_send: "Отправить сообщение", contact_feedback_success: "Сообщение успешно отправлено (симуляция). Спасибо!", contact_feedback_error: "Ошибка при отправке сообщения (симуляция). Пожалуйста, попробуйте еще раз.",
        donations_title: "Поддержите нас / Пожертвования", donations_intro: "Разработка независимых игр требует много усилий и самоотдачи. Если вам нравится моя работа и вы хотите поддержать создание Название Игры и будущих проектов, пожалуйста, рассмотрите возможность пожертвования. Каждый вклад очень помогает!", donations_popular_platforms: "Популярные платформы", donations_paypal: "Пожертвовать через PayPal", donations_patreon: "Поддержать на Patreon", donations_kofi: "Купить мне кофе (Ko-fi)", donations_direct_title: "Прямое пожертвование (Рекомендуется)", donations_direct_intro: "Это самый прямой способ поддержки, гарантирующий, что большая часть вашего вклада пойдет на разработку без посредников.", donations_direct_button: "Сделать прямое пожертвование",
        copyright: "&copy; 2024 Имя Разработчика / Студия. Все права защищены."
      }
    };

    // --- Story Data with Translations ---
    const storyData = {
      start: {
        image: "story-image-forest.png",
        text: { en: "The air is heavy...", es: "El aire es pesado...", ja: "空気は重く...", ru: "Воздух тяжелый..." }, // Truncated for brevity
        choices: [
          { text: { en: "Follow the path", es: "Seguir el sendero", ja: "小道を進む", ru: "Идти по тропе" }, target: "path" },
          { text: { en: "Examine the nearby trees", es: "Examinar los árboles cercanos", ja: "近くの木を調べる", ru: "Осмотреть ближайшие деревья" }, target: "examine_trees" }
        ]
      },
      path: {
        image: "story-image-path.png",
        text: { en: "You advance cautiously...", es: "Avanzas con cautela...", ja: "慎重に進む...", ru: "Вы осторожно продвигаетесь..." }, // Truncated
        choices: [
          { text: { en: "Go left...", es: "Ir por la izquierda...", ja: "左へ...", ru: "Идти налево..." }, target: "left_path" },
          { text: { en: "Go right...", es: "Ir por la derecha...", ja: "右へ...", ru: "Идти направо..." }, target: "right_path" },
          { text: { en: "Return to the start", es: "Volver al inicio", ja: "最初に戻る", ru: "Вернуться к началу" }, target: "start" }
        ]
      },
       examine_trees: {
        text: { en: "You approach a gnarled trunk...", es: "Te acercas a un tronco nudoso...", ja: "節くれだった幹に近づく...", ru: "Вы подходите к корявому стволу..." }, // Truncated
        choices: [
          { text: { en: "Ignore the feeling...", es: "Ignorar la sensación...", ja: "感覚を無視して...", ru: "Игнорировать ощущение..." }, target: "path" },
          { text: { en: "Try to climb the tree", es: "Intentar escalar el árbol", ja: "木に登ろうとする", ru: "Попытаться залезть на дерево" }, target: "climb_tree" }
        ]
      },
       left_path: {
        image: "story-image-laugh.png",
        text: { en: "A sound guides you...", es: "Un sonido te guía...", ja: "音があなたを導く...", ru: "Звук ведет вас..." }, // Truncated
        choices: [
          { text: { en: "Accept the cup", es: "Aceptar la taza", ja: "カップを受け入れる", ru: "Принять чашку" }, target: "accept_tea" },
          { text: { en: "Refuse and flee", es: "Rechazar y huir", ja: "断って逃げる", ru: "Отказаться и бежать" }, target: "flee_tea" }
        ]
      },
       right_path: {
        text: { en: "The silence is dense...", es: "El silencio es denso...", ja: "静寂は濃く...", ru: "Тишина плотная..." }, // Truncated
        choices: [
          { text: { en: "Pick up the watch", es: "Recoger el reloj", ja: "時計を拾う", ru: "Подобрать часы" }, target: "take_watch" },
          { text: { en: "Leave it and continue", es: "Dejarlo y seguir", ja: "そのままにして進む", ru: "Оставить и идти дальше" }, target: "continue_right" }
        ]
      },
       climb_tree: {
        text: { en: "The branches are slippery...", es: "Las ramas son resbaladizas...", ja: "枝は滑りやすく...", ru: "Ветви скользкие..." }, // Truncated
        choices: [ { text: { en: "Wake up...", es: "Despertar...", ja: "目を覚ます...", ru: "Проснуться..." }, target: "start" } ]
      },
       accept_tea: {
        text: { en: "The liquid is thick...", es: "El líquido es espeso...", ja: "液体は濃く...", ru: "Жидкость густая..." }, // Truncated
        choices: [ { text: { en: "...", es: "...", ja: "...", ru: "..." }, target: "start" } ]
      },
       flee_tea: {
           image: "story-image-path.png",
           text: { en: "You run without looking back...", es: "Corres sin mirar atrás...", ja: "後ろを振り返らずに走り...", ru: "Вы бежите без оглядки..." }, // Truncated
           choices: [
             { text: { en: "Go right this time", es: "Ir por la derecha esta vez", ja: "今度は右へ", ru: "На этот раз пойти направо" }, target: "right_path" },
             { text: { en: "Return to the forest entrance", es: "Volver al inicio del bosque", ja: "森の入り口に戻る", ru: "Вернуться к началу леса" }, target: "start" }
           ]
       },
       take_watch: {
           text: { en: "Touching the cold metal...", es: "Al tocar el frío metal...", ja: "冷たい金属に触れると...", ru: "Прикоснувшись к холодному металлу..." }, // Truncated
           choices: [ { text: { en: "Continue down the silent path", es: "Continuar por el camino silencioso", ja: "静かな道を進み続ける", ru: "Продолжить идти по тихой тропе" }, target: "continue_right_changed" } ]
       },
       continue_right: {
           text: { en: "You press on...", es: "Sigues adelante...", ja: "進み続ける...", ru: "Вы идете дальше..." }, // Truncated
           choices: [
               { text: { en: "Hasten your pace", es: "Apresurar el paso", ja: "ペースを上げる", ru: "Ускорить шаг" }, target: "end_demo" },
               { text: { en: "Stop and listen", es: "Detenerse y escuchar", ja: "立ち止まって聞く", ru: "Остановиться и прислушаться" }, target: "end_demo" }
           ]
       },
       continue_right_changed: {
            image: "story-image-changed.png",
            text: { en: "The path is now covered...", es: "El sendero ahora está cubierto...", ja: "道は今、覆われている...", ru: "Тропа теперь покрыта..." }, // Truncated
            choices: [
                 { text: { en: "Push through the thorns", es: "Abrirse paso entre las espinas", ja: "棘をかき分けて進む", ru: "Пробираться сквозь шипы" }, target: "end_demo" },
                 { text: { en: "Look for another way", es: "Buscar otro camino", ja: "別の道を探す", ru: "Искать другой путь" }, target: "end_demo" }
            ]
       },
       end_demo: {
           text: { en: "Darkness closes in...", es: "La oscuridad se cierra...", ja: "闇が迫る...", ru: "Тьма сгущается..." }, // Truncated
           choices: [ { text: { en: "Start over", es: "Volver a empezar", ja: "最初からやり直す", ru: "Начать сначала" }, target: "start"} ]
       }
    };

    // --- Global Variables ---
    const storyImageElement = document.getElementById('story-image');
    const storyTextElement = document.getElementById('story-text');
    const storyChoicesElement = document.getElementById('story-choices');
    const langSelectElement = document.getElementById('lang-select');
    let currentTimeoutId = null;
    let currentLanguage = 'en';
    let currentPassageId = 'start';

    // --- Typewriter Function ---
    function typeWriter(element, text, speed = 50) {
      if (currentTimeoutId) { clearTimeout(currentTimeoutId); currentTimeoutId = null; }
      element.innerHTML = ""; let i = 0;
      function type() {
        if (i < text.length) {
          if (text.substring(i, i + 4) === '<br>') { element.innerHTML += '<br>'; i += 4; }
          else { element.innerHTML += text.charAt(i); i++; }
          currentTimeoutId = setTimeout(type, speed);
        } else { currentTimeoutId = null; }
      }
      if (text && text.length > 0) { type(); }
    }

    // --- Show Passage Function ---
    function showPassage(passageId) {
      currentPassageId = passageId;
      const passage = storyData[passageId];
      if (!passage) { return; } // Exit if passage not found

      if (passage.image) {
        storyImageElement.src = passage.image;
        storyImageElement.alt = `Scene: ${passageId}`;
        storyImageElement.style.display = 'block';
      } else {
        storyImageElement.style.display = 'none';
      }

      const passageText = passage.text[currentLanguage] || passage.text['en'];
      typeWriter(storyTextElement, passageText);

      storyChoicesElement.innerHTML = '';
      if (passage.choices && passage.choices.length > 0) {
        const ul = document.createElement('ul');
        passage.choices.forEach(choice => {
          const li = document.createElement('li'); const a = document.createElement('a');
          a.href = '#';
          const choiceText = choice.text[currentLanguage] || choice.text['en'];
          a.textContent = choiceText;
          a.addEventListener('click', (event) => { event.preventDefault(); showPassage(choice.target); });
          li.appendChild(a); ul.appendChild(li);
        });
        storyChoicesElement.appendChild(ul);
      }
    }

    // --- Set Language Function ---
    function setLanguage(lang) {
      if (!translations[lang]) { lang = 'en'; }
      currentLanguage = lang;
      localStorage.setItem('preferredLanguage', lang);
      langSelectElement.value = lang;
      document.documentElement.lang = lang;

      document.querySelectorAll('[data-translate-key]').forEach(element => {
        const key = element.getAttribute('data-translate-key');
        const translation = translations[lang][key] || translations['en'][key];
        if (translation) {
          if (key === 'copyright') { element.innerHTML = translation; }
          else { element.textContent = translation; }
        }
      });

      if (currentTimeoutId) { clearTimeout(currentTimeoutId); currentTimeoutId = null; }
      showPassage(currentPassageId);
    }

    // --- Initialization & Event Listeners ---
    document.addEventListener('DOMContentLoaded', () => {
      const savedLang = localStorage.getItem('preferredLanguage');
      const initialLang = savedLang && translations[savedLang] ? savedLang : 'en';
      setLanguage(initialLang);

      langSelectElement.addEventListener('change', (event) => {
        setLanguage(event.target.value);
      });

      // Contact Form Listener
      const contactForm = document.getElementById('contact-form');
      const contactFeedback = document.getElementById('contact-feedback');
      if (contactForm && contactFeedback) {
        contactForm.addEventListener('submit', (event) => {
          event.preventDefault();
          contactFeedback.textContent = translations[currentLanguage]['contact_feedback_success'] || translations['en']['contact_feedback_success'];
          contactFeedback.className = 'success';
          contactFeedback.style.display = 'block';
          contactForm.reset();
          setTimeout(() => {
            contactFeedback.style.display = 'none';
            contactFeedback.textContent = '';
            contactFeedback.className = '';
          }, 5000);
        });
      }

      // Donation Buttons Listener (Simulation)
      const donationButtons = document.querySelectorAll('.donation-button');
      donationButtons.forEach(button => {
        if (!button.getAttribute('href') || button.getAttribute('href') === '#') {
            button.addEventListener('click', (event) => {
                event.preventDefault();
                const type = button.classList.contains('direct') ? 'Direct' : button.classList.contains('paypal') ? 'PayPal' : button.classList.contains('patreon') ? 'Patreon' : button.classList.contains('kofi') ? 'Ko-fi' : 'Unknown';
                alert(`Redirecting to ${type}... (simulation)`);
            });
        }
      });

      // Buy Button Listener (Simulation)
      const buyButton = document.querySelector('.buy-button');
      if (buyButton) {
        buyButton.addEventListener('click', () => { alert('Redirecting to store... (simulation)'); });
      }

      // Smooth Scroll Listener
      document.querySelectorAll('.main-nav a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          const targetId = this.getAttribute('href');
          if (targetId.length > 1) {
              e.preventDefault();
              const targetElement = document.querySelector(targetId);
              if (targetElement) { targetElement.scrollIntoView({ behavior: 'smooth' }); }
          }
        });
      });
    });

    // Estado del juego
    let gameState = {
        level: 1,
        points: 0,
        inventory: [],
        currentLocation: 'Inicio',
        storyProgress: 0,
        achievements: []
    };

    // Sistema de historias
    const storySystem = {
        scenes: {
            start: {
                text: "Bienvenido a la historia. Te encuentras en un lugar misterioso...",
                choices: [
                    { text: "Explorar el área", nextScene: "explore", points: 10 },
                    { text: "Buscar pistas", nextScene: "search", points: 15 }
                ]
            },
            explore: {
                text: "Mientras exploras, encuentras un objeto misterioso...",
                choices: [
                    { text: "Recoger el objeto", nextScene: "pickup", points: 20 },
                    { text: "Examinar más detalladamente", nextScene: "examine", points: 25 }
                ]
            },
            // Agregar más escenas aquí
        },

        updateScene(sceneId) {
            const scene = this.scenes[sceneId];
            if (!scene) return;

            document.getElementById('story-text').textContent = scene.text;
            document.getElementById('current-location').textContent = sceneId;
            
            const choicesContainer = document.getElementById('story-choices');
            choicesContainer.innerHTML = '';
            
            scene.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'game-choice';
                button.innerHTML = `
                    <span class="choice-prefix">></span>
                    <span class="choice-text">${choice.text}</span>
                `;
                button.addEventListener('click', () => this.makeChoice(choice));
                choicesContainer.appendChild(button);
            });
        },

        makeChoice(choice) {
            gameState.points += choice.points;
            this.updateStats();
            this.updateScene(choice.nextScene);
        },

        updateStats() {
            document.getElementById('story-level').textContent = gameState.level;
            document.getElementById('story-points').textContent = gameState.points;
            this.updateInventory();
        },

        updateInventory() {
            const inventoryContainer = document.getElementById('inventory-items');
            inventoryContainer.innerHTML = '';
            
            gameState.inventory.forEach((item, index) => {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                slot.textContent = item;
                inventoryContainer.appendChild(slot);
            });
        },

        saveGame() {
            localStorage.setItem('gameState', JSON.stringify(gameState));
        },

        loadGame() {
            const savedState = localStorage.getItem('gameState');
            if (savedState) {
                gameState = JSON.parse(savedState);
                this.updateStats();
                this.updateScene(gameState.currentLocation);
            }
        }
    };

    // Inicialización
    document.addEventListener('DOMContentLoaded', () => {
        // Inicializar el juego
        storySystem.updateScene('start');
        storySystem.updateStats();

        // Manejar botones de guardar/cargar
        document.querySelectorAll('.game-choice').forEach(button => {
            button.addEventListener('click', (e) => {
                const choiceText = e.currentTarget.querySelector('.choice-text').textContent;
                if (choiceText === 'Guardar partida') {
                    storySystem.saveGame();
                } else if (choiceText === 'Cargar partida') {
                    storySystem.loadGame();
                }
            });
        });
    });

    // Configuración de partículas
    const PARTICLE_CONFIG = {
        desktop: {
            count: 50,
            size: 2,
            speed: 20
        },
        mobile: {
            count: 20,
            size: 1,
            speed: 15
        }
    };

    // Clase para manejar las partículas
    class ParticleManager {
        constructor() {
            this.particles = [];
            this.config = window.innerWidth <= 768 ? PARTICLE_CONFIG.mobile : PARTICLE_CONFIG.desktop;
            this.init();
        }

        init() {
            this.createParticles();
            this.handleResize();
        }

        createParticles() {
            const container = document.querySelector('.hero-section');
            if (!container) return;

            for (let i = 0; i < this.config.count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.animationDuration = `${this.config.speed + Math.random() * 5}s`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                container.appendChild(particle);
                this.particles.push(particle);
            }
        }

        handleResize() {
            window.addEventListener('resize', () => {
                const newConfig = window.innerWidth <= 768 ? PARTICLE_CONFIG.mobile : PARTICLE_CONFIG.desktop;
                if (newConfig.count !== this.config.count) {
                    this.cleanup();
                    this.config = newConfig;
                    this.createParticles();
                }
            });
        }

        cleanup() {
            this.particles.forEach(particle => particle.remove());
            this.particles = [];
        }
    }

    // Clase para manejar el contador regresivo
    class CountdownTimer {
        constructor() {
            this.targetDate = new Date('2025-10-04T00:00:00');
            this.elements = {
                days: document.getElementById('days'),
                hours: document.getElementById('hours'),
                minutes: document.getElementById('minutes'),
                seconds: document.getElementById('seconds')
            };
            this.init();
        }

        init() {
            this.updateTimer();
            setInterval(() => this.updateTimer(), 1000);
        }

        updateTimer() {
            const now = new Date();
            const difference = this.targetDate - now;

            if (difference <= 0) {
                this.handleCountdownEnd();
                return;
            }

            const days = Math.floor(difference / (1000 * 60 * 60 * 24));
            const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((difference % (1000 * 60)) / 1000);

            this.updateElements(days, hours, minutes, seconds);
        }

        updateElements(days, hours, minutes, seconds) {
            this.elements.days.textContent = String(days).padStart(2, '0');
            this.elements.hours.textContent = String(hours).padStart(2, '0');
            this.elements.minutes.textContent = String(minutes).padStart(2, '0');
            this.elements.seconds.textContent = String(seconds).padStart(2, '0');
        }

        handleCountdownEnd() {
            // Aquí puedes agregar la lógica para cuando el contador llegue a cero
            console.log('Countdown ended!');
        }
    }

    // Clase para manejar el efecto magnético
    class MagneticEffect {
        constructor() {
            this.elements = document.querySelectorAll('.magnetic-effect');
            this.init();
        }

        init() {
            this.elements.forEach(element => {
                element.addEventListener('mousemove', (e) => this.handleMouseMove(e, element));
                element.addEventListener('mouseleave', () => this.handleMouseLeave(element));
            });
        }

        handleMouseMove(e, element) {
            const rect = element.getBoundingClientRect();
            const x = e.clientX - rect.left - rect.width / 2;
            const y = e.clientY - rect.top - rect.height / 2;

            element.style.transform = `translate(${x * 0.1}px, ${y * 0.1}px)`;
        }

        handleMouseLeave(element) {
            element.style.transform = 'translate(0, 0)';
        }
    }

    // Inicialización
    document.addEventListener('DOMContentLoaded', () => {
        // Inicializar el administrador de partículas
        const particleManager = new ParticleManager();

        // Inicializar el contador regresivo
        const countdownTimer = new CountdownTimer();

        // Inicializar el efecto magnético
        const magneticEffect = new MagneticEffect();

        // Manejar el scroll suave
        window.addEventListener('scroll', () => {
            const header = document.querySelector('.main-nav');
            if (window.scrollY > 50) {
                header.style.background = 'rgba(0, 0, 0, 0.95)';
            } else {
                header.style.background = 'rgba(0, 0, 0, 0.8)';
            }
        });

        // Manejar el scroll suave para los enlaces internos
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                if (targetId.length > 1) {
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            });
        });
    });

    document.addEventListener('DOMContentLoaded', () => {
        const hamburger = document.querySelector('.hamburger');
        const navLinks = document.querySelector('.nav-links');
        const navbar = document.querySelector('.navbar');
        const sections = document.querySelectorAll('section');
        const navLinksItems = document.querySelectorAll('.nav-links a');

        // Estado del menú
        let isMenuOpen = false;

        // Función para alternar el menú
        const toggleMenu = () => {
            isMenuOpen = !isMenuOpen;
            navLinks.classList.toggle('active');
            hamburger.classList.toggle('active');
            
            // Animar las líneas del hamburger
            const spans = hamburger.querySelectorAll('span');
            if (isMenuOpen) {
                spans[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
                spans[1].style.opacity = '0';
                spans[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
            } else {
                spans[0].style.transform = 'none';
                spans[1].style.opacity = '1';
                spans[2].style.transform = 'none';
            }
        };

        // Event listener para el botón hamburger
        hamburger.addEventListener('click', toggleMenu);

        // Cerrar el menú cuando se hace clic en un enlace
        navLinksItems.forEach(link => {
            link.addEventListener('click', () => {
                if (isMenuOpen) {
                    toggleMenu();
                }
            });
        });

        // Cerrar el menú cuando se hace clic fuera
        document.addEventListener('click', (e) => {
            if (isMenuOpen && !hamburger.contains(e.target) && !navLinks.contains(e.target)) {
                toggleMenu();
            }
        });

        // Cambiar el color del navbar al hacer scroll
        let lastScroll = 0;
        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;

            // Agregar/remover clase para el fondo del navbar
            if (currentScroll > 50) {
                navbar.style.backgroundColor = 'rgba(44, 62, 80, 0.95)';
            } else {
                navbar.style.backgroundColor = 'var(--primary-color)';
            }

            // Ocultar/mostrar navbar al hacer scroll
            if (currentScroll > lastScroll && currentScroll > 100) {
                navbar.style.transform = 'translateY(-100%)';
            } else {
                navbar.style.transform = 'translateY(0)';
            }

            lastScroll = currentScroll;
        });

        // Animación suave para los enlaces de navegación
        navLinksItems.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href');
                const targetSection = document.querySelector(targetId);
                
                if (targetSection) {
                    targetSection.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Animación de aparición para las secciones
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        sections.forEach(section => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(20px)';
            section.style.transition = 'all 0.6s ease-out';
            observer.observe(section);
        });

        // Prevenir el scroll cuando el menú está abierto
        const preventScroll = (e) => {
            if (isMenuOpen) {
                e.preventDefault();
            }
        };

        window.addEventListener('scroll', preventScroll, { passive: false });
    });

    document.addEventListener('DOMContentLoaded', function() {
        // Navegación entre secciones
        const navLinks = document.querySelectorAll('.main-nav a');
        const sections = document.querySelectorAll('section');

        function showSection(sectionId) {
            // Ocultar todas las secciones
            sections.forEach(section => {
                section.classList.remove('active-section');
            });

            // Mostrar la sección seleccionada
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active-section');
            }

            // Actualizar el enlace activo
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${sectionId}`) {
                    link.classList.add('active');
                }
            });
        }

        // Manejar clics en los enlaces de navegación
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('href').substring(1);
                showSection(sectionId);
            });
        });

        // Mostrar la sección inicial
        showSection('home');

        // Efecto de glitch en el logo
        const logo = document.querySelector('.main-logo');
        setInterval(() => {
            if (Math.random() < 0.1) {
                logo.classList.add('glitch');
                setTimeout(() => {
                    logo.classList.remove('glitch');
                }, 1000);
            }
        }, 5000);

        // Efecto de hover en los enlaces
        navLinks.forEach(link => {
            link.addEventListener('mouseover', function() {
                this.style.color = 'var(--primary-color)';
                this.style.textShadow = '0 0 10px var(--primary-color)';
            });

            link.addEventListener('mouseout', function() {
                if (!this.classList.contains('active')) {
                    this.style.color = 'var(--text-color)';
                    this.style.textShadow = 'none';
                }
            });
        });
    });
